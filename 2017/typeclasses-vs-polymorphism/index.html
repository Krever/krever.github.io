<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Typeclass: when inheritance is not enough</title>
  <meta name="description" content="Heuristically Optimized Person">
  <meta name="author" content="Wojciech Pituła">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Wojciech Pituła">
  <meta name="twitter:description" content="Heuristically Optimized Person">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Wojciech Pituła">
  <meta property="og:description" content="Heuristically Optimized Person">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://w.pitula.me//2017/typeclasses-vs-polymorphism/">
  <link rel="alternate" type="application/rss+xml" title="Wojciech Pituła" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Wojciech Pituła">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Wojciech Pituła</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">Heuristically Optimized Person</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Wojciech Pituła blog" class="blog-button">Blog</a></li>
              <li class="navigation__item"><a href="http://w.pitula.me/presentations" title="link to my presentations">Presentations</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/Krever01" title="@Krever01 on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/krever" title="krever on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/Krever" title="Krever on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:w.pitula@gmail.com" title="Email w.pitula@gmail.com" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>
          
            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="25 Mar 2017" class="post-meta__date date">25 Mar 2017</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#scala">scala</a> </span>
    </div>
    <h1 class="post-title">Typeclass: when inheritance is not enough</h1>
  </header>

  <section class="post">
    <p>If you ask Wikipedia about polymorphism, it will tell you that it is about <em>“provisioning a single interface to entities of different types”</em>. And this is true(remember that interface here and in whole post means API, not some element that is part of the language, like scala’s <code class="highlighter-rouge">trait</code>). In the following post we will go through a series of cases where traditional way of implementing polymorphism(by which I mean inheritance) is not enough .</p>

<h3 id="basic-example">Basic example</h3>
<p>Just to remind what is the typeclass, let’s look at the same interface encoded with inheritance and typeclass:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//inheritance
</span><span class="k">trait</span> <span class="nc">Hello</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">hello</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">World</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Hello</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">hello</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"Hello "</span><span class="o">+</span><span class="n">name</span>
<span class="o">}</span>
<span class="k">new</span> <span class="nc">World</span><span class="o">(</span><span class="s">"Earth"</span><span class="o">).</span><span class="n">hello</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//typeclass
</span><span class="k">trait</span> <span class="nc">Hello</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">hello</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">World</span><span class="o">(</span><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="k">val</span> <span class="n">helloWorld</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Hello</span><span class="o">[</span><span class="kt">World</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">hello</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">World</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"Hello "</span><span class="o">+</span><span class="n">t</span><span class="o">.</span><span class="n">name</span>
<span class="o">}</span>
<span class="n">helloWorld</span><span class="o">.</span><span class="n">hello</span><span class="o">(</span><span class="k">new</span> <span class="nc">World</span><span class="o">(</span><span class="s">"Earth"</span><span class="o">))</span>    
</code></pre>
</div>

<p>As we can see inheritance variant is less verbose and nicer to use. So why would anybody want to use typeclasses anyway? Here are some reasons…</p>

<h3 id="problem-1-derive-interface-for-new-types-automatically">Problem 1: Derive interface for new types automatically</h3>
<p>Imagine you have following code already there. Nothing sophisticated, one interface that says <em>“you can convert something to <code class="highlighter-rouge">String</code>“</em>, and few methods depending on it.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">serialize</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">}</span>

<span class="k">def</span> <span class="n">writeToFile</span><span class="o">(</span><span class="n">data</span><span class="k">:</span> <span class="kt">Serializable</span><span class="o">,</span>  <span class="n">file</span><span class="k">:</span> <span class="kt">File</span><span class="o">)</span>
<span class="k">def</span> <span class="n">writeToSocket</span><span class="o">(</span><span class="n">data</span><span class="k">:</span> <span class="kt">Serializable</span><span class="o">,</span>  <span class="n">socket</span><span class="k">:</span> <span class="kt">Socket</span><span class="o">)</span>
<span class="k">def</span> <span class="n">print</span><span class="o">(</span><span class="n">data</span><span class="k">:</span> <span class="kt">Serializable</span><span class="o">)</span>
</code></pre>
</div>

<p>But after some time you add a json support:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Json</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">write</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">}</span>
<span class="k">trait</span> <span class="nc">Jsonable</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">toJson</span><span class="k">:</span> <span class="kt">Json</span>
<span class="o">}</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Jsonable</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre>
</div>

<p>And then you would like to use the old api without modyfing it. Just like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">print</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"John"</span><span class="o">,</span> <span class="mi">18</span><span class="o">))</span>
</code></pre>
</div>

<p>Sadly, it’s not possible, because <code class="highlighter-rouge">User</code> doesn’t implement <code class="highlighter-rouge">Serializable</code>, although it can be easily converted to string through <code class="highlighter-rouge">Json</code> abstraction. Ther are three ways to go:</p>

<ul>
  <li>create 3 new overloads taking <code class="highlighter-rouge">Jsonable</code> interface instead of <code class="highlighter-rouge">Serializable</code> - this is obviously wrong, as it doesn’t scale</li>
  <li>make <code class="highlighter-rouge">User</code> implement <code class="highlighter-rouge">Serializable</code> - this is not a good solution, because you don’t always have access to particular type, and even if you do, you have to do this for every type that is <code class="highlighter-rouge">Jsonable</code> and not <code class="highlighter-rouge">Serializable</code></li>
  <li>create conversion method <code class="highlighter-rouge">jsonableToSerializable</code> - this is better approach, but you loose you original type during such conversion and also(at least with explicit conversion) you have to call this method explicitly with every use of original API. If you go with implicit conversion, it is almost good,  but it has may limitations(e.g. cannot be chained, like <code class="highlighter-rouge">Jsonable</code> -&gt; <code class="highlighter-rouge">Serializable</code> -&gt; <code class="highlighter-rouge">SomethingElse</code>)</li>
</ul>

<p>Lets see how such scenario can look with typeclass encoding:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Serializable</span><span class="o">[</span><span class="kt">T</span><span class="o">]{</span>
    <span class="k">def</span> <span class="n">serialize</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">}</span>
<span class="k">def</span> <span class="n">writeToFile</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">Serializable</span><span class="o">](</span><span class="n">data</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span>  <span class="n">file</span><span class="k">:</span> <span class="kt">File</span><span class="o">)</span>
<span class="k">def</span> <span class="n">writeToSocket</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">Serializable</span><span class="o">](</span><span class="n">data</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span>  <span class="n">socket</span><span class="k">:</span> <span class="kt">Socket</span><span class="o">)</span>
<span class="k">def</span> <span class="n">print</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">Serializable</span><span class="o">](</span><span class="n">data</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span>
                                 
<span class="k">trait</span> <span class="nc">Json</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">write</span><span class="k">:</span> <span class="kt">String</span>
<span class="o">}</span>
<span class="k">trait</span> <span class="nc">Jsonable</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">toJson</span><span class="o">(</span><span class="n">v</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">Json</span>
<span class="o">}</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">userJsonable</span><span class="k">:</span> <span class="kt">Jsonable</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
                                         
<span class="k">implicit</span> <span class="k">def</span> <span class="n">jsonableToSerializable</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">Jsonable</span><span class="o">]</span><span class="k">:</span> <span class="kt">Serializable</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Serializable</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">serialize</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">implicitly</span><span class="o">[</span><span class="kt">Jsonable</span><span class="o">[</span><span class="kt">T</span><span class="o">]].</span><span class="n">toJson</span><span class="o">(</span><span class="n">t</span><span class="o">).</span><span class="n">write</span>
<span class="o">}</span>
                                             
<span class="n">print</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="s">"John"</span><span class="o">,</span> <span class="mi">18</span><span class="o">))</span>
</code></pre>
</div>

<h3 id="problem-2-provide-multiple-implementations">Problem 2: Provide multiple implementations</h3>
<p>You want to compare objects. But you want to do this in multiple ways in different contexts. This cannot be done with inheritance, so we will go with typeclass encoding right away.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Equatable</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">equals</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span>
<span class="o">}</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
<span class="k">val</span> <span class="n">eq1</span><span class="k">:</span> <span class="kt">Equatable</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
<span class="k">val</span> <span class="n">eq2</span><span class="k">:</span> <span class="kt">Equatable</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</code></pre>
</div>

<h3 id="problem-3-define-external-interface-for-external-type">Problem 3: Define external interface for external type</h3>
<p>This is very common(at least for me) situation. We have a type defined in module/library A</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre>
</div>

<p>and an interface defined in module/library B:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Equatable</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">equals</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Any</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span>
<span class="o">}</span>
</code></pre>
</div>

<p>now we would like to define <code class="highlighter-rouge">User</code> as <code class="highlighter-rouge">Equatable</code>. This cannot be done with inheritance and is straight forward with typeclasses.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// defined in module A
</span><span class="k">trait</span> <span class="nc">Equatable</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">equals</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span>
<span class="o">}</span>
<span class="c1">// defined in module B
</span><span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">name</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
<span class="c1">// defined in module C
</span><span class="k">implicit</span> <span class="k">val</span> <span class="n">userEq</span><span class="k">:</span> <span class="kt">Equatable</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</code></pre>
</div>

<h4 id="problem-35-define-interface-for-simple-types">Problem 3.5: Define interface for simple types</h4>
<p>There is no way to inherit from simple types like <code class="highlighter-rouge">Int</code> or <code class="highlighter-rouge">Float</code> so there is no way to make them conform to any interface by inheritance. Happily typeclasses doesn’t have this problem:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">val</span> <span class="n">intEq</span><span class="k">:</span> <span class="kt">Equatable</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</code></pre>
</div>

<h3 id="problem-4-get-exact-type-that-implements-the-interface">Problem 4: Get exact type that implements the interface</h3>
<p>Let’s create <code class="highlighter-rouge">Sortable</code> interface, that will tell us that given collection can be sorted. The best we can do with pure inheritance is:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Sortable</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">sort</span><span class="o">()</span><span class="k">:</span> <span class="kt">Sortable</span> <span class="c1">//or Any
</span><span class="o">}</span>
</code></pre>
</div>

<p>Not very useful because we loose all type information after sorting. It gets a little better if we add some generics:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Sortable</span><span class="o">[</span><span class="kt">Coll</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">sort</span><span class="o">()</span><span class="k">:</span> <span class="kt">Coll</span> 
<span class="o">}</span>
</code></pre>
</div>

<p>But still, there is no way to be sure that output collection is exactly the same type as output one(we can create <code class="highlighter-rouge">class List extends Sortable[Set]</code>). To solve this we have to use typeclass that looks almost exactly the same:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Sortable</span><span class="o">[</span><span class="kt">Coll</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">sort</span><span class="o">(</span><span class="n">coll</span><span class="k">:</span> <span class="kt">Coll</span><span class="o">)</span><span class="k">:</span> <span class="kt">Coll</span> 
<span class="o">}</span>
</code></pre>
</div>

<h3 id="problem-5-implement-multiple-interfaces-with-dependencies">Problem 5: Implement multiple interfaces with dependencies</h3>
<p>Imagine, that to make something <code class="highlighter-rouge">Jsonable</code>, we have to provide some dependency object, and the same goes with <code class="highlighter-rouge">Persistent</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Jsonable</span><span class="o">(</span><span class="n">jsonFactory</span><span class="k">:</span> <span class="kt">JsonFactory</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Persistent</span><span class="o">(</span><span class="n">persistenceCtx</span><span class="k">:</span> <span class="kt">PersistenceContext</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
																	 
<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">username</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span> <span class="c1">// no way to inherit both, at least until dotty is here
</span></code></pre>
</div>

<p>So again, we fallback to typeclasses:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Jsonable</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">jsonFactory</span><span class="k">:</span> <span class="kt">JsonFactory</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Persistent</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">persistenceCtx</span><span class="k">:</span> <span class="kt">PersistenceContext</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">username</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span> 
<span class="k">implicit</span> <span class="k">val</span> <span class="n">userJsonable</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Jsonable</span><span class="o">[</span><span class="kt">User</span><span class="o">](???)</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">userPersistent</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Persistent</span><span class="o">[</span><span class="kt">User</span><span class="o">](???)</span>
</code></pre>
</div>

<h3 id="problem-6-define-static-function">Problem 6: Define static function</h3>
<p>We would like to define an interface that allows to create an instance of given type from <code class="highlighter-rouge">String</code> and, as you probably have guessed by now, it cannot be done with inheritance, because to inherit some behavior you need and instance already. With typeclass it is straight forward:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">FromString</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">create</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">T</span> 
<span class="o">}</span>
</code></pre>
</div>

<h2 id="summary">Summary</h2>
<p>We have seen some examples, where typeclasses show their expressive power. They are great tools, but I would like to advise you to use them carefully. There are some problems with typeclasses, and two greatest ones are:</p>

<ul>
  <li>they are not as widely understood as inheritance, so if you are working with some Java developers, make sure they understand the idea</li>
  <li>implicits can become a head ache very easily and you can’t use typeclasses efficiently without implicits</li>
</ul>

<p>So remember good old Uncle Ben:</p>

<blockquote>
  <p>With great power comes great responsibility</p>
</blockquote>


  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://w.pitula.me/2017/typeclasses-vs-polymorphism/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2017/typeclasses-vs-polymorphism'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//kreverspace.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
       })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2017 Wojciech Pituła. All rights reserved.</span>
</footer> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-88803396-1', 'auto');
  ga('send', 'pageview');
</script>

    </div>
  </body>
</html>