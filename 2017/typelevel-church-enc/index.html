<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Scala Typelevel Church Encodings</title>
  <meta name="description" content="Heuristically Optimized Person">
  <meta name="author" content="Wojciech Pituła">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Wojciech Pituła">
  <meta name="twitter:description" content="Heuristically Optimized Person">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Wojciech Pituła">
  <meta property="og:description" content="Heuristically Optimized Person">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://w.pitula.me//2017/typelevel-church-enc/">
  <link rel="alternate" type="application/rss+xml" title="Wojciech Pituła" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Wojciech Pituła">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Wojciech Pituła</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">Heuristically Optimized Person</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Wojciech Pituła blog" class="blog-button">Blog</a></li>
              <li class="navigation__item"><a href="http://w.pitula.me/presentations" title="link to my presentations">Presentations</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/Krever01" title="@Krever01 on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/krever" title="krever on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/Krever" title="Krever on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:w.pitula@gmail.com" title="Email w.pitula@gmail.com" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>
          
            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="20 Apr 2017" class="post-meta__date date">20 Apr 2017</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#scala">scala</a> <a href="/tags/#typelevel propgramming">typelevel propgramming</a> </span>
    </div>
    <h1 class="post-title">Scala Typelevel Church Encodings</h1>
  </header>

  <section class="post">
    <p>You have probably heard about <a href="https://en.wikipedia.org/wiki/Lambda_calculus">Lambda calculus</a>, right? Basically everything you have there is lambdas. And to do anything with them it is nice to use <a href="https://en.wikipedia.org/wiki/Church_encoding">Church encoding</a>, which is a way to represent natural numbers, booleans, conditionals and simple data structures using only lambdas.</p>

<p>Another fact: in Scala we have <a href="https://en.wikipedia.org/wiki/Kind_(type_theory)">Higher-kinded types</a> which are basically typelevel functions(they are one from another). So the question is: can we implement Church encoding using only types, so all the computations are done during compilation? Spoiler: <strong>YES, WE CAN!</strong>. Let’s see how.</p>

<h2 id="type-lambda">Type Lambda</h2>
<p>To start doing anything we need to declare something that will help us abstract over type functions:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// equivalent to something like type TL = TL =&gt; TL
</span><span class="k">trait</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">&lt;:</span> <span class="nc">TL</span>
<span class="o">}</span>
</code></pre>
</div>
<p>In lambda calculus everything is a function, so this why <code class="highlighter-rouge">TL#Apply</code> argument has upper bound of <code class="highlighter-rouge">TL</code>. Now we can do fancy stuff like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">type</span> <span class="kt">func1</span> <span class="k">&lt;:</span> <span class="kt">TL</span> <span class="o">=</span> <span class="o">...</span> 
<span class="k">type</span> <span class="kt">arg1</span> <span class="k">&lt;:</span> <span class="kt">TL</span> <span class="o">=</span> <span class="o">...</span> 
<span class="k">type</span> <span class="kt">result</span> <span class="o">=</span> <span class="n">func1</span><span class="k">#</span><span class="nc">Apply</span><span class="o">[</span><span class="kt">arg1</span><span class="o">]</span> <span class="c1">// equiv. to val result = func1(arg1)
</span></code></pre>
</div>
<p>How can we use <em>“instantiate”</em> such type lambda? Here are some examples:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// equiv. to val identity = (x:TL) =&gt; x
// λx.x
</span><span class="k">type</span> <span class="kt">Identity</span> <span class="o">=</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="n">T</span>
<span class="o">}</span>
<span class="c1">// equiv. to def const(a: TL) = (_:TL) =&gt; a
// λa.λt.a
</span><span class="k">type</span> <span class="kt">Const</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="n">A</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="church-encoding-examples">Church encoding examples</h2>
<p>Here are some examples of how to implement elements of Church encoding:</p>

<h3 id="bools">Bools</h3>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// λa.λb.a
</span><span class="k">type</span> <span class="kt">True</span> <span class="o">=</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
    <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">B</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="n">A</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// λa.λb.b
</span><span class="k">type</span> <span class="kt">False</span> <span class="o">=</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
    <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">B</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="n">B</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// λp.λq.p q p
</span><span class="k">type</span> <span class="kt">And</span> <span class="o">=</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">P</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
    <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">Q</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="n">P</span><span class="k">#</span><span class="nc">Apply</span><span class="o">[</span><span class="kt">Q</span><span class="o">]</span><span class="k">#</span><span class="nc">Apply</span><span class="o">[</span><span class="kt">P</span><span class="o">]</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="natural-numbers">Natural numbers</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// λf.λx.x
</span><span class="k">type</span> <span class="kt">Zero</span> <span class="o">=</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">F</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
    <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">X</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="n">X</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// λn.λf.λx.f (n f x)
</span><span class="k">type</span> <span class="kt">Succ</span> <span class="o">=</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">N</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
    <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">F</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
      <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">X</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="n">F</span><span class="k">#</span><span class="nc">Apply</span><span class="o">[</span><span class="kt">N</span><span class="k">#</span><span class="kt">Apply</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span><span class="k">#</span><span class="kt">Apply</span><span class="o">[</span><span class="kt">X</span><span class="o">]]</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// λm.λn.λf.λ
</span><span class="k">type</span> <span class="kt">Plus</span> <span class="o">=</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">M</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
    <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">N</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
      <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">F</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
        <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">X</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="n">M</span><span class="k">#</span><span class="nc">Apply</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span><span class="k">#</span><span class="nc">Apply</span><span class="o">[</span><span class="kt">N</span><span class="k">#</span><span class="kt">Apply</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span><span class="k">#</span><span class="kt">Apply</span><span class="o">[</span><span class="kt">X</span><span class="o">]]</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="boring-">BORING !!!</h2>

<p>Yes, this is boring, because once we know the pattern, implementing next elements is just translating text from wikipedia. So I have done that for you and almost all encodings are available on github as <a href="https://github.com/Krever/sturch-encodings">Krever/sturch-encodings</a>. If you’re interested in details feel free to go there(it consists of 5 files, so don’t be scared). The library also contains very simple reflection-based parser for such encodings(so we can print it or convert to realt int/boolean).</p>

<p>The most complicated type available there is <code class="highlighter-rouge">Predecessor</code> defined like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// λn.λf.λx.n (λg.λh.h (g f)) (λu.x) (λv.v)
</span><span class="k">type</span> <span class="kt">Pred</span> <span class="o">=</span> <span class="nc">TL</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">N</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
    <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">F</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="nc">TL</span> <span class="o">{</span>
      <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">X</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="k">=</span> <span class="n">N</span><span class="k">#</span><span class="nc">Apply</span><span class="o">[</span><span class="kt">TL</span> <span class="o">{</span>
        <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">G</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="kt">=</span> <span class="kt">TL</span> <span class="o">{</span>
          <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">H</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="kt">=</span> <span class="kt">H</span><span class="k">#</span><span class="kt">Apply</span><span class="o">[</span><span class="kt">G</span><span class="k">#</span><span class="kt">Apply</span><span class="o">[</span><span class="kt">F</span><span class="o">]]</span>
        <span class="o">}</span>
      <span class="o">}]</span><span class="k">#</span><span class="nc">Apply</span><span class="o">[</span><span class="kt">TL</span> <span class="o">{</span>
        <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">U</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="kt">=</span> <span class="kt">X</span>
      <span class="o">}]</span><span class="k">#</span><span class="nc">Apply</span><span class="o">[</span><span class="kt">TL</span> <span class="o">{</span>
        <span class="k">type</span> <span class="kt">Apply</span><span class="o">[</span><span class="kt">V</span> <span class="k">&lt;:</span> <span class="kt">TL</span><span class="o">]</span> <span class="kt">=</span> <span class="kt">V</span>
      <span class="o">}]</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>If you don’t understand, don’t worry, neither do I. But it works :)</p>

<h2 id="what-can-we-do-with-it">What can we do with it?</h2>
<p>I have to admit, this almost completely useless. Lambda Calculus on value level doesn’t have many applications, and when we go to the type level it is even more impractical.</p>

<p>But anyway, it is fun and creating this was nice exercise in type level programming . With some additional syntactic sugars we can write code like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">sturch.nats._</span>
<span class="k">import</span> <span class="nn">sturch.bools._</span>

<span class="k">type</span> <span class="kt">x</span> <span class="o">=</span> <span class="nc">Plus</span><span class="o">[</span><span class="kt">`</span><span class="err">3</span><span class="kt">`</span>, <span class="kt">`</span><span class="err">4</span><span class="kt">`</span><span class="o">]</span>
<span class="k">type</span> <span class="kt">y</span> <span class="o">=</span> <span class="nc">Mult</span><span class="o">[</span><span class="kt">`</span><span class="err">3</span><span class="kt">`</span>, <span class="kt">`</span><span class="err">2</span><span class="kt">`</span><span class="o">]</span>
<span class="k">type</span> <span class="kt">`IsTypelevelProgrammingFun?`</span> <span class="o">=</span> <span class="nc">Not</span><span class="o">[</span><span class="kt">EQ</span><span class="o">[</span><span class="kt">x</span>, <span class="kt">y</span><span class="o">]]</span>
<span class="k">type</span> <span class="kt">result</span> <span class="o">=</span> <span class="nc">If</span><span class="o">[</span><span class="kt">`IsTypelevelProgrammingFun?`</span>, <span class="kt">Mult</span><span class="o">[</span><span class="kt">x</span>, <span class="kt">y</span><span class="o">]</span>, <span class="kt">Zero</span><span class="o">]</span>
</code></pre>
</div>
<p>So we can solve almost any problem without running our program! We don’t have loops, but who needs them anyway. And one more time we have proven that Scala type system is turing complete.</p>


  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://w.pitula.me/2017/typelevel-church-enc/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2017/typelevel-church-enc'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//kreverspace.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
       })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2018 Wojciech Pituła. All rights reserved.</span>
</footer> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-88803396-1', 'auto');
  ga('send', 'pageview');
</script>

    </div>
  </body>
</html>